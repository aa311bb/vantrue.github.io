import{P as J,N as E,O as X,x as _,ai as ee,$ as oe,d as D,r as T,a as L,b as d,T as R,y as N,U as j,j as $,v as K,c as te,B as ne,E as ae,S as se,Y as le,aj as ce,F as re,z}from"./index-De6GvLOu.js";import{n as P,t as y,C as F,p as H,c as M,j as ie,w as U,m as b,Q as ue,x as de,H as fe,I as ve}from"./index-CRmXhf89.js";import{u as ye}from"./use-expose-Oe1mBPbS.js";import{u as me}from"./use-touch-B8mpADtW.js";import{u as Y}from"./use-lazy-render-gBwbLmzk.js";let Ie=2e3;const he=()=>++Ie,G={show:Boolean,zIndex:P,overlay:y,duration:P,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:F,transitionAppear:Boolean,closeOnClickOverlay:y},Ee=Object.keys(G);let I=0;const p="van-overflow-hidden";function Oe(e,o){const n=me(),f="01",a="10",c=r=>{n.move(r);const v=n.deltaY.value>0?a:f,x=ee(r.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:C}=x;let i="11";C===0?i=O>=m?"00":"01":C+O>=m&&(i="10"),i!=="11"&&n.isVertical()&&!(parseInt(i,2)&parseInt(v,2))&&H(r,!0)},s=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",c,{passive:!1}),I||document.body.classList.add(p),I++},l=()=>{I&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",c),I--,I||document.body.classList.remove(p))},k=()=>o()&&s(),h=()=>o()&&l();J(k),E(h),X(h),_(o,r=>{r?s():l()})}const A=()=>{var e;const{scopeId:o}=((e=oe())==null?void 0:e.vnode)||{};return o?{[o]:""}:null},[Ce,we]=M("overlay"),Pe={show:Boolean,zIndex:P,duration:P,className:F,lockScroll:y,lazyRender:y,customStyle:Object};var ke=D({name:Ce,props:Pe,setup(e,{slots:o}){const n=T(),f=Y(()=>e.show||!e.lazyRender),a=s=>{e.lockScroll&&H(s,!0)},c=f(()=>{var s;const l=N(ie(e.zIndex),e.customStyle);return j(e.duration)&&(l.animationDuration=`${e.duration}s`),$(d("div",{ref:n,style:l,class:[we(),e.className]},[(s=o.default)==null?void 0:s.call(o)]),[[K,e.show]])});return L("touchmove",a,{target:n}),()=>d(R,{name:"van-fade",appear:!0},{default:c})}});const xe=U(ke),Se=N({},G,{round:Boolean,position:b("center"),closeIcon:b("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:b("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[be,B]=M("popup");var Te=D({name:be,inheritAttrs:!1,props:Se,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:f}){let a,c;const s=T(),l=T(),k=Y(()=>e.show||!e.lazyRender),h=te(()=>{const t={zIndex:s.value};if(j(e.duration)){const u=e.position==="center"?"animationDuration":"transitionDuration";t[u]=`${e.duration}s`}return t}),r=()=>{a||(a=!0,s.value=e.zIndex!==void 0?+e.zIndex:he(),o("open"))},v=()=>{a&&de(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},x=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&v()},m=()=>{if(e.overlay)return d(xe,z({show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},A(),{onClick:x}),{default:f["overlay-content"]})},O=t=>{o("clickCloseIcon",t),v()},C=()=>{if(e.closeable)return d(ve,{role:"button",tabindex:0,name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:O},null)};let i;const Z=()=>{i&&clearTimeout(i),i=setTimeout(()=>{o("opened")})},V=()=>o("closed"),Q=t=>o("keydown",t),W=k(()=>{var t;const{round:u,position:w,safeAreaInsetTop:S,safeAreaInsetBottom:q}=e;return $(d("div",z({ref:l,style:h.value,role:"dialog",tabindex:0,class:[B({round:u,[w]:w}),{"van-safe-area-top":S,"van-safe-area-bottom":q}],onKeydown:Q},n,A()),[(t=f.default)==null?void 0:t.call(f),C()]),[[K,e.show]])}),g=()=>{const{position:t,transition:u,transitionAppear:w}=e,S=t==="center"?"van-fade":`van-popup-slide-${t}`;return d(R,{name:u||S,appear:w,onAfterEnter:Z,onAfterLeave:V},{default:W})};return _(()=>e.show,t=>{t&&!a&&(r(),n.tabindex===0&&ne(()=>{var u;(u=l.value)==null||u.focus()})),!t&&a&&(a=!1,o("close"))}),ye({popupRef:l}),Oe(l,()=>e.show&&e.lockScroll),L("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),ae(()=>{e.show&&r()}),se(()=>{c&&(o("update:show",!0),c=!1)}),E(()=>{e.show&&e.teleport&&(v(),c=!0)}),le(ue,()=>e.show),()=>e.teleport?d(ce,{to:e.teleport},{default:()=>[m(),g()]}):d(re,null,[m(),g()])}});const _e=U(Te);export{xe as O,_e as P,G as a,A as b,Ee as p,Oe as u};
