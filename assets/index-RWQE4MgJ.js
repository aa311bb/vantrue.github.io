import{d as Q,D as p,r as Z,c as H,x as z,a as ne,b as u,K as ce,e as ee,E as re,B as me,z as ve,A as ue}from"./index-De6GvLOu.js";import{u as oe}from"./use-expose-Oe1mBPbS.js";import{c as ae,o as E,n as K,p as $,D as y,M as ge,t as b,e as de,a as B,C as V,m as G,l as fe,f as he,H as we,I as Ie,x as Pe,w as Ce}from"./index-CRmXhf89.js";import{a as Se,S as xe}from"./index-D9I-z36f.js";import{P as ye}from"./index-ChOJ9s9T.js";import{u as be}from"./use-touch-B8mpADtW.js";import{I as Te}from"./index-CXizdvbV.js";import{L as ke}from"./index-DpB2-7h_.js";const U=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),Ye=o=>({x:(o[0].clientX+o[1].clientX)/2,y:(o[0].clientY+o[1].clientY)/2}),N=ae("image-preview")[1],J=2.6,Oe={src:String,show:Boolean,active:Number,minZoom:E(K),maxZoom:E(K),rootWidth:E(Number),rootHeight:E(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var Xe=Q({props:Oe,emits:["scale","close","longPress"],setup(o,{emit:v,slots:I}){const e=p({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),c=be(),l=Z(),P=Z(),T=Z(!1),g=Z(!1);let k=0;const Y=H(()=>{const{scale:a,moveX:t,moveY:i,moving:n,zooming:m,initializing:w}=e,D={transitionDuration:m||n||w?"0s":".3s"};return(a!==1||g.value)&&(D.transform=`matrix(${a}, 0, 0, ${a}, ${t}, ${i})`),D}),d=H(()=>{if(e.imageRatio){const{rootWidth:a,rootHeight:t}=o,i=T.value?t/e.imageRatio:a;return Math.max(0,(e.scale*i-a)/2)}return 0}),f=H(()=>{if(e.imageRatio){const{rootWidth:a,rootHeight:t}=o,i=T.value?t:a*e.imageRatio;return Math.max(0,(e.scale*i-t)/2)}return 0}),O=(a,t)=>{var i;if(a=y(a,+o.minZoom,+o.maxZoom+1),a!==e.scale){const n=a/e.scale;if(e.scale=a,t){const m=ee((i=l.value)==null?void 0:i.$el),w={x:m.width*.5,y:m.height*.5},D=e.moveX-(t.x-m.left-w.x)*(n-1),le=e.moveY-(t.y-m.top-w.y)*(n-1);e.moveX=y(D,-d.value,d.value),e.moveY=y(le,-f.value,f.value)}else e.moveX=0,e.moveY=g.value?k:0;v("scale",{scale:a,index:o.active})}},C=()=>{O(1)},W=()=>{const a=e.scale>1?1:2;O(a,a===2||g.value?{x:c.startX.value,y:c.startY.value}:void 0)};let S,X,x,s,h,r,M,L,_=!1;const te=a=>{const{touches:t}=a;if(S=t.length,S===2&&o.disableZoom)return;const{offsetX:i}=c;c.start(a),X=e.moveX,x=e.moveY,L=Date.now(),_=!1,e.moving=S===1&&(e.scale!==1||g.value),e.zooming=S===2&&!i.value,e.zooming&&(s=e.scale,h=U(t))},ie=a=>{const{touches:t}=a;if(c.move(a),e.moving){const{deltaX:i,deltaY:n}=c,m=i.value+X,w=n.value+x;if((o.vertical?c.isVertical()&&Math.abs(w)>f.value:c.isHorizontal()&&Math.abs(m)>d.value)&&!_){e.moving=!1;return}_=!0,$(a,!0),e.moveX=y(m,-d.value,d.value),e.moveY=y(w,-f.value,f.value)}if(e.zooming&&($(a,!0),t.length===2)){const i=U(t),n=s*i/h;r=Ye(t),O(n,r)}},A=a=>{var t;const i=(t=P.value)==null?void 0:t.$el;if(!i)return;const n=i.firstElementChild,m=a.target===i,w=n==null?void 0:n.contains(a.target);!o.closeOnClickImage&&w||!o.closeOnClickOverlay&&m||v("close")},se=a=>{if(S>1)return;const t=Date.now()-L,i=250;c.isTap.value&&(t<i?o.doubleScale?M?(clearTimeout(M),M=null,W()):M=setTimeout(()=>{A(a),M=null},i):A(a):t>ge&&v("longPress"))},j=a=>{let t=!1;if((e.moving||e.zooming)&&(t=!0,e.moving&&X===e.moveX&&x===e.moveY&&(t=!1),!a.touches.length)){e.zooming&&(e.moveX=y(e.moveX,-d.value,d.value),e.moveY=y(e.moveY,-f.value,f.value),e.zooming=!1),e.moving=!1,X=0,x=0,s=1,e.scale<1&&C();const i=+o.maxZoom;e.scale>i&&O(i,r)}$(a,t),se(a),c.reset()},q=()=>{const{rootWidth:a,rootHeight:t}=o,i=t/a,{imageRatio:n}=e;T.value=e.imageRatio>i&&n<J,g.value=e.imageRatio>i&&n>=J,g.value&&(k=(n*a-t)/2,e.moveY=k,e.initializing=!0,ce(()=>{e.initializing=!1})),C()},F=a=>{const{naturalWidth:t,naturalHeight:i}=a.target;e.imageRatio=i/t,q()};return z(()=>o.active,C),z(()=>o.show,a=>{a||C()}),z(()=>[o.rootWidth,o.rootHeight],q),ne("touchmove",ie,{target:H(()=>{var a;return(a=P.value)==null?void 0:a.$el})}),oe({resetScale:C}),()=>{const a={loading:()=>u(ke,{type:"spinner"},null)};return u(Se,{ref:P,class:N("swipe-item"),onTouchstartPassive:te,onTouchend:j,onTouchcancel:j},{default:()=>[I.image?u("div",{class:N("image-wrap")},[I.image({src:o.src,onLoad:F,style:Y.value})]):u(Te,{ref:l,src:o.src,fit:"contain",class:N("image",{vertical:T.value}),style:Y.value,onLoad:F},a)]})}}});const[Re,R]=ae("image-preview"),Ze=["show","teleport","transition","overlayStyle","closeOnPopstate"],ze={show:Boolean,loop:b,images:de(),minZoom:B(1/3),maxZoom:B(3),overlay:b,vertical:Boolean,closeable:Boolean,showIndex:b,className:V,closeIcon:G("clear"),transition:String,beforeClose:Function,doubleScale:b,overlayClass:V,overlayStyle:Object,swipeDuration:B(300),startPosition:B(0),showIndicators:Boolean,closeOnPopstate:b,closeOnClickImage:b,closeOnClickOverlay:b,closeIconPosition:G("top-right"),teleport:[String,Object]};var Me=Q({name:Re,props:ze,emits:["scale","close","closed","change","longPress","update:show"],setup(o,{emit:v,slots:I}){const e=Z(),c=Z(),l=p({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),P=()=>{if(e.value){const s=ee(e.value.$el);l.rootWidth=s.width,l.rootHeight=s.height,e.value.resize()}},T=s=>v("scale",s),g=s=>v("update:show",s),k=()=>{Pe(o.beforeClose,{args:[l.active],done:()=>g(!1)})},Y=s=>{s!==l.active&&(l.active=s,v("change",s))},d=()=>{if(o.showIndex)return u("div",{class:R("index")},[I.index?I.index({index:l.active}):`${l.active+1} / ${o.images.length}`])},f=()=>{if(I.cover)return u("div",{class:R("cover")},[I.cover()])},O=()=>{l.disableZoom=!0},C=()=>{l.disableZoom=!1},W=()=>u(xe,{ref:e,lazyRender:!0,loop:o.loop,class:R("swipe"),vertical:o.vertical,duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:Y,onDragEnd:C,onDragStart:O},{default:()=>[o.images.map((s,h)=>u(Xe,{ref:r=>{h===l.active&&(c.value=r)},src:s,show:o.show,active:l.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:o.doubleScale,closeOnClickImage:o.closeOnClickImage,closeOnClickOverlay:o.closeOnClickOverlay,vertical:o.vertical,onScale:T,onClose:k,onLongPress:()=>v("longPress",{index:h})},{image:I.image}))]}),S=()=>{if(o.closeable)return u(Ie,{role:"button",name:o.closeIcon,class:[R("close-icon",o.closeIconPosition),we],onClick:k},null)},X=()=>v("closed"),x=(s,h)=>{var r;return(r=e.value)==null?void 0:r.swipeTo(s,h)};return oe({resetScale:()=>{var s;(s=c.value)==null||s.resetScale()},swipeTo:x}),re(P),z([fe,he],P),z(()=>o.startPosition,s=>Y(+s)),z(()=>o.show,s=>{const{images:h,startPosition:r}=o;s?(Y(+r),me(()=>{P(),x(+r,{immediate:!0})})):v("close",{index:l.active,url:h[l.active]})}),()=>u(ye,ve({class:[R(),o.className],overlayClass:[R("overlay"),o.overlayClass],onClosed:X,"onUpdate:show":g},ue(o,Ze)),{default:()=>[S(),W(),d(),f()]})}});const Le=Ce(Me);export{Le as I,Me as s};
